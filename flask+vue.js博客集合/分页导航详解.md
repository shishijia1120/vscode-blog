# 分页导航详解

### （博客列表）前台
分页导航的核心：前后台相互传递的参数：***per_page***(每页条数)、***page***(当前页码)

分页组件：
```html
<el-pagination
      @size-change="handleSizeChange"
      @current-change="handleCurrentChange"
      :current-page.sync="currentPage"
      :page-sizes="[3, 5, 10]"
      :page-size="per_page"
      layout="sizes, prev, pager, next,total"
      :total="total"
    ></el-pagination>
```
前台data:
```javascript
 data() {
    return {
      sharedState: store.state,
      posts: "",
      currentPage:1,//当前页码
      per_page:3,//每页条数
      total:0,//总条数
    }
```
前台获取数据方法：
```javascript
methods: {
    getPosts() {
      const path = `/api/posts?page=${this.currentPage}&per_page=${this.per_page}`;
      this.$axios
        .get(path)
        .then(response => {
          // handle success
          this.posts = response.data;
          this.currentPage=this.posts._meta.page;
          this.per_page=this.posts._meta.per_page;
          this.total=this.posts._meta.total_items;
        })
        .catch(error => {
          // handle error
          console.log(error.response.data);
        });
    },
    handleCurrentChange(){
      this.getPosts();
    },
    handleSizeChange(val){
      this.per_page=val;
      this.getPosts();
    },
```
- 默认当前页码为1，每页条数为5，总条数为0，当列表初始化时，获取后台传递的（5条）数据记录posts，同时更新data()中当前currentPage(当前页码)、per_page(每页条数)、total(总条数)。
- 当点击切换组件的页码时，触发handleCurrentChange函数
- 当点击切换组件中的每页条数时，触发handleSizeChange函数
### （博客列表）后台：


/posts:
```python
def get_posts():
    page=request.args.get('page',1,type=int)
    per_page=min(request.args.get('per_page',10,type=int))
    data=Post.to_collection_dict(Post.query.order_by(Post.timestamp.desc()),page,per_page,'api_get_post)
     return jsonify(data)
```
models.py中PaginatedAPIMixin类：
```python
def to_collection_dict(query,page,per_page,endpoint,**kwargs):
    resources=query.paginate(page,per_page,False)
    data={
        'items':[item.to_dict() for item in resources.items],
        '_meta':{
            'page':page,
            'per_page':per_page,
            'total_pages':resources.pages,
            'total_items':resources.total
        },
        '_links':{
            'self':url_for(endpoint,page=page,per_page=per_page,**kwargs),
            'next':url_for(endpoint,page=page,per_page=per_page,**kwargs)if resources.has_next else None,
            'prev':url_for(endpoint,page=page,per_page=per_page,**kwargs)if resources.has_prev else None,
        }
    }
    return data

```
真正的核心代码：
```python
def to_collection_dict(query,page,per_page,endpoint,**kwargs):
  resources=query.paginate(page,per_page,False)
```
flask SQLALchemy中的Pagination对象，一个Query对象调用paginate方法就获得Pagination对象。paginate方法传入了两个参数，一个是当前页，另一个是每页条数。paginate方法的返回值为当前页的Pagination对象。
Pagination对象的常用属性有：
- items
- query
- page
- pages
- total
- has_next
- has_prev
- prev_num
- next_num

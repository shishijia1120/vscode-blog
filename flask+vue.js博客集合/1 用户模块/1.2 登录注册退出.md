
## 1 Vue-Router导航
### 1.3 导航守卫beforEach
只有用户登录后才能访问Home、Profile等，需使用vue-router的router.beforeEach()在每次路由前判断是否需要使用用户验证。

修改index.js:

```javascript
import Vue from 'vue'
import Router from 'vue-router'
import Home from '@/components/Home'
import Login from '@/components/Login'
import Register from '@/components/Register'
import Profile from '@/components/Profile'
import Ping from '@/components/Ping'

Vue.use(Router)

const router = new Router({
  routes: [
    {
      path: '/',
      name: 'Home',
      component: Home,
      meta: {
        requiresAuth: true
      }
    },
    {
      path: '/login',
      name: 'Login',
      component: Login
    },
    {
      path: '/register',
      name: 'Register',
      component: Register
    },
    {
      path: '/profile',
      name: 'Profile',
      component: Profile,
      meta: {
        requiresAuth: true
      }
    },
    {
      path: '/ping',
      name: 'Ping',
      component: Ping
    }
  ]
})

router.beforeEach((to, from, next) => {
  const token = window.localStorage.getItem('token')
  if (to.matched.some(record => record.meta.requiresAuth) && (!token || token === null)) {
    next({
      path: '/login',
      query: { redirect: to.fullPath }
    })
  } else if (token && to.name == 'Login') {
    // 用户已登录，但又去访问登录页面时不让他过去
    next({
      path: from.fullPath
    })
  } else {
    next()
  }
})

export default router

```

## 2.用户注册

## 3.状态管理
使用store来进行状态管理。

创建store.js:
```javascript
export default {
  debug: true,
  state: {
    is_new: false
  },
  setNewAction () {
    if (this.debug) { console.log('setNewAction triggered') }
    this.state.is_new = true
  },
  resetNotNewAction () {
    if (this.debug) { console.log('resetNotNewAction triggered') }
    this.state.is_new = false
  }
}
```

注册组件Register.vue中要要引入store，当注册成功时，调用setNewAction:
```javascript
<script>
import store from '../store.js'
...

axios.post(path, payload)
        .then((response) => {
          // handle success
          store.setNewAction()
          this.$router.push('/login')
        })
...
```
登录组件Login.vue中要引入Alert.vue和store，


同理，当用户登录前导航栏上显示Login，用户登录后显示Logout，也需要一个共同的状态is_authenticated。
```javascript
export default {
  debug: true,
  state: {
    is_new: false,
    is_authenticated: window.localStorage.getItem('madblog-token') ? true : false
  },
  setNewAction () {
    if (this.debug) { console.log('setNewAction triggered') }
    this.state.is_new = true
  },
  resetNotNewAction () {
    if (this.debug) { console.log('resetNotNewAction triggered') }
    this.state.is_new = false
  },
  loginAction () {
    if (this.debug) { console.log('loginAction triggered') }
    this.state.is_authenticated = true
  },
  logoutAction () {
    if (this.debug) console.log('logoutAction triggered')
    window.localStorage.removeItem('madblog-token')
    this.state.is_authenticated = false
  }
}
```


## 4.用户登录
重点，实现Basic Auth需要在config中设置auth这个属性：
```javascript
 const path = 'http://localhost:5000/api/tokens'
      // axios 实现Basic Auth需要在config中设置 auth 这个属性即可
      axios.post(path, {}, {
        auth: {
          'username': this.loginForm.username,
          'password': this.loginForm.password
        }
      }).then((response) => {
//handle success
 window.localStorage.setItem('madblog-token', response.data.token)
 store.resetNotNewAction()
 store.loginAction()
```







## 5.用户退出
在导航栏中显示 Logout 按钮，绑定单击事件：
```javascript
<template>
  ...
          <li class="nav-item">
            <a v-on:click="handlerLogout" class="nav-link" href="#">Logout</a>
          </li>
  ...
</template>

<script>
import store from '../store.js'

export default {
  name: 'Navbar',  //this is the name of the component
  data () {
    return {
      sharedState: store.state
    }
  },
  methods: {
    handlerLogout (e) {
      store.logoutAction()
      this.$router.push('/login')
    }
  }
}
</script>
```
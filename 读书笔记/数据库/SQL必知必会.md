## 1 基础知识
### 1.1 了解SQL
1. 什么是SQL
设计SQL的目的是很好地完成一项任务——提供一种从数据库中读写数据的简单有效的方法。
2. SQL优点
- SQL不是某个特定数据库供应商专有的语言。几乎所有重要的DBMS都支持SQL。
- SQL简单易学。
- SQL尽管看上去很简单，但实际上是一种强有力的语言，灵活使用其语言元素，可以进行非常复杂和高级的数据库操作。
3. 基本概念
SQL语句是由简单的英语单词构成的，这些单词称为关键字，每个SQL语句都是由一个或多个关键字构成的。
**关键字**作为SQL组成部分的保留字，不能用作表或列的名字。

**子句(clause)**SQL语句由子句构成，有些子句是必需的(from 子句)，而有的可选。
一个子句通常由一个关键字加上所提供的数据组成。

**操作符(operator)**用来联接或改变WHERE子句中的子句的关键字。

### 1.2 检索数据
SELECT
### 1.3 排序检索数据
1. ORDER BY
2. 指定排序方向 DESC
### 1.4 过滤数据
1. WHERE子句的位置：在同时使用ORDER BY和WHERE子句时，应该让ORDER BY位于WHERE之后，否则会产生错误。
2. WHERE子句操作符 ： （BETWEEN···AND） 、（IS NULL）、= 、！=、
### 1.5 高级过滤数据
1. AND操作符
2. OR操作符
3. 计算次序：WHERE可包含任意数目的AND和OR操作符。允许两者结合以进行复杂和高级的过滤。
   AND在计算次序中优先级更高，可以使用圆括号明确地分组相应的操作符
4. IN操作符，功能上与OR操作符相同
    优点：语法清楚直观、次序更容易管理、比OR操作符执行更快、最大优点是可以包含其它SELECT语句，使得能更动态地建立WHERE子句。
5. NOT操作符：WHERE子句中用来否定后跟条件的关键字。
   select name from products where not id='1' order by name;
   简单的使用<>操作符代替，但在更复杂的子句中，NOT是非常有用的。

### 1.6 用通配符进行过滤
1. 通配符：用来匹配值的一部分的特殊字符，只能用于文本字段(串)，非文本数据类型字段不能使用通配符搜索。
2. 搜索模式：由字面值、通配符或两者组合构成的搜索条件
3. LIKE操作符：为在搜索子句中使用通配符，必须使用LIKE操符。LIKE指示DBMS，后跟的搜索模式利用通配符匹配而不是直接相等匹配进行比较。
   
**通配符简介**
1. %：表示任何字符出现任意次数
select name from customers where name like 'fish%';
2. _：下划线只匹配单个字符而不是多个字符
select id from customers where name like '__ inch teddy bear';
3. []：用来指定一个字符集
select name from customers where name like '[JM]%';

前缀字符^来否定

**通配符的技巧**
1. 不要过分使用通配符，如果其它操作符能达到相同的目的，应该使用其它操作符。
2. 最好不要把通配符放在搜索模式的开始处，否则速度是最慢的。
3. 注意通配符的位置。

### 1.7 创建计算字段
1. 拼接：将值联结到一起构成单个值
MySQL中的拼接： select CONCAT(name,'(',country,')') from countrys;

若想正确返回格式化的数据，必须去掉这些空格，可使用SQL的RTRIM()函数来完成。

**使用别名**：AS
2. 执行算术计算：对检索出来的数据进行算术计算

### 1.8 使用数据处理函数

**函数带来的问题**
与几乎所有DBMS都等同地支持SQL语句(如SELECT)不同，每一个DBMS都有特定的函数。事实上，只要少数几个函数被所有主要的DBMS等同地支持。

1. 文本处理函数
|函数|说明|
|----|----|
|LEFT()||
|RIGHT()||
|LTRIM()||
|RTRIM()||
|LENGTH()||
|LOWER()||
|UPPER()||
|||


2. 日期和时间处理函数
日期和时间采用相应的数据类型存储在表中，每种DBMS都有自己的变体，可移植性最差。
日期和时间值以特殊的格式存储，以便能快速和有效地排序或过滤，并且节省物理存储空间。

3. 数值处理函数
数值函数仅处理数值数据，使用不频繁。但在主要DBMS的函数中，数值函数是最统一的函数。
|函数|说明|
|----|----|
|ABS()||
|COS||
|···|···|

### 1.9 汇总数据
有时候我们需要汇总数据而不用把它们实际检索出来，为此SQL提供了5个聚集函数。
**聚集函数**:运行在行组上，计算和返回单个值的函数。
|函数|说明|
|----|----|
|AVG()||
|COUNT()||
|MAX()||
|MIN()||
|SUM()||

1. AVG()：可用来返回所有列的平均值，也可用来返回特定列或行的平均值。AVG()函数忽略列值为NULL的行。

2. COUNT():确定表中行的数目或符合特定条件的行的数目。
- count(*):对表中行的数目进行计数，不管表列中包含的是空值(NULL)还是非空值。
- count(column)：对特定列中具有值的行进行计数，忽略NULL值。
  
3. MAX()函数：返回指定列中的最大值。
4. MIN()函数：返回指定列的最小值。 
5. SUM()函数：返回指定列值的和(总计)。

**聚集不同值**
以上5个聚集函数都可以如下使用：
- 对所有的行执行计算，指定ALL参数或不给参数(ALL是默认行为)。
- 只包含不同的值，指定DISTINCT参数。

**组合聚集函数**


### 1.10 分组数据

1. 创建分组：GROUP BY
- GROUP BY 子句必须出现在WHERE子句之后，ORDER BY子句之前。
2. 过滤分组：HAVING子句，基于分组聚集值而不是特定行值的。WHERE过滤指定的是列而不是分组。HAVING支持所有的WHERE操作符。

3. 分组和排序

4. SELECT子句顺序
SELECT > FROM > WHERE > GROUP BY > HAVING > ORDER BY    

### 1.11 使用子查询
1. 利用子查询进行过滤
- 能嵌套的子查询的数目没有限制，不过在实际使用时由于性能的限制，不能嵌套太多的子查询。
- 作为子查询的SELECT语句只能查询单个列，企图检索多个列将返回错误。
2. 作为计算字段使用子查询

### 1.12 联结表
SQL最强大的功能之一就是能在数据查询的执行中联结表。联结是利用SQL的SELECT能执行的最重要的操作。

1. 创建联结
SELECT a.name,b.price FROM a,b WHERE a.id = b.id;
- WHERE子句作为过滤条件，只包含那些匹配联结条件的行。

**笛卡儿积**:由没有联结条件的表关系返回的结果为笛卡儿积。检索出来的行的数目将是第一个表中的行数乘以第二个表中的行数。
1. 内部联结(等值联结)
SELECT ... FROM a INNER JOIN b ON a.id = b.id;  
3. 联结多个表


### 1.13 创建高级联结
1. 使用表别名
2. 使用不同类型的联结
- 自联结
许多DBMS处理联结远比处理子查询快得多，建议使用自联结。
- 自然联结
- 外部联结





### 1.14 组合查询
1. 创建组合查询



### 1.15 插入数据
1. 插入数据
- 插入完整的行
INSERT INTO Customers(cust_id,cust_name,cust_city) VALUES('1001','Toy Land','123 Street');
- 插入部分的行
- 插入检索出的数据
2. 从一个表复制到另一个表
- INSERT INTO和 SELECT INTO的差别，前者是导出数据，而后者导入表
SELECT * INTO CustCopy FROM Customers；
MySQL的语法：CREATE TABLE CustCopy AS SELECT * FROM Customers;
- 使用SELECT INTO时，任何SELECT 选项和子句都可以使用，包括WHERE和GROUP BY。
- 可利用联结从多个表插入数据
- 不管从多少个表中检索数据，数据都只能插入到多个表中。
### 1.16 更新和删除数据
1. 更新数据
UPDATE Customer SET cus_contact = 'sam' cust_email='sam@163.com' WHERE cust_id='1001';   
2. 删除数据
DELETE FROM Customers WHERE cust_id='1001';

3. 更新和删除的指导原则

### 1.17 创建和操纵表
1. 创建表
CREATE TABLE Products 
(
   id CHAR(10) NOT NULL,
   name CHAR(10) NOT NULL
);

2. 更新表
- 所有DBMS都允许给现有的表增加列
- 许多DBMS不允许删除或更改表中的列
ALTER TABLE Vendors ADD phone CHAR(20);
3. 删除表
DROP TABLE CustCopy;
4. 重命名表


## 2 进阶知识
### 2.1 使用视图
视图为虚拟的表，它们包含的不是数据而是根据需要检索数据的查询。视图提供了一种封装SELECT语句的层次，可用来简化数据处理以及重新格式化基础数据或保护基础数据。

视图仅仅是用来查看存储在别处的数据的一种设施。视图本身不包含数据，因此它们返回的数据是从其他表中检索出来的。在添加或更改这些表中的数据时，视图将返回改变过的数据。

**什么情况下必须使用视图？**

所有DBMS非常一致地支持视图创建语法。
**为什么使用视图**
- 重用SQL语句
- 简化复杂的SQL操作
- 使用表的组成部分而不是整个表
- 保护数据
- 更改数据格式和表示。视图可返回与底层表的表示和格式不同的数据。


1. 创建视图
CREATE VIEW ProducctCustomers AS 
SELECT cust_name,cust_contact,prod_id
FROM Customers,Orders,OrderItems
WHERE Customers.cust_id = Orders.cust_id
AND OrderItems.order_num = Orders.order_num;

2. 用视图重新格式化检索出的数据
3. 用视图过滤不想要的数据
4. 使用视图与计算字段

### 2.2 使用存储过程
存储过程简单来说，就是为以后的使用而保存的一条或多条SQL语句的集合。

**为什么要使用存储过程**
- 简化复杂的操作
- 保证了数据的一致性
- 简化对变动的管理
- 因为存储过程通常以编译过的形式存储，所以DBMS为处理命令所做的工作较少。所以提高了性能。
- 可通过它们来编写功能更强更灵活的代码。
**存储过程的缺陷**


1. 创建存储过程


### 2.3 管理事务处理
事务处理可以用来维护数据库的完整性，保证成批的SQL操作要么完全执行，要么完全不执行。
**事务处理的关键术语**
- 事务，指一组SQL语句
- 回退，指撤销指定SQL语句的过程
- 提交，指将未存储的SQL语句结果写入数据库表
- 保留点

1. 控制事务处理
2. 使用ROLLBACK
3. 使用COMMIT
4. 使用保留点
   
### 2.4 使用游标
游标是一个存储在DBMS服务器上的数据库查询，它不是一条SELECT语句，而是被该语句检索出来的结果集。在存储了游标之后，应用程序可以根据需要滚动或浏览其中的数据。

1. 创建游标
2. 使用游标
3. 关闭游标



### 2.5 了解高级SQL特性
1. 约束
- 主键
- 外键
- 唯一约束
- 检查约束
2. 索引
3. 触发器
4. 数据库安全

### 2.6 附录
#### SQL数据类型
1. 串数据类型
2. 数值数据类型
3. 日期和时间数据类型
4. 二进制数据类型
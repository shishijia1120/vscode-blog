
## 2 简单的HTTP协议
本章将针对HTTP协议结构进行讲解，主要使用HTTP/1.1版本。


### 2.1 HTTP协议用于客户端和服务器端之间的通信
HTTP协议和TCP/IP协议族内的其他众多的协议相同，用于客户端和服务器之间的通信。

请求访问文本或图像等资源的一端称为客户端，而提供资源响应的一端称为服务器端。


在一条通信线路上必定有一端是客户端，另一端是服务器端。而用HTTP协议就能够明确区分哪端是客户端，哪端是服务器端。

----
### 2.2 通过请求和响应的交换达成通信
HTTP协议规定，请求从客户端发出，最后服务器端响应应该请求并返回。换句话说，肯定是从客户端开始建立通信，服务器端在每一接收到请求之前不会发送响应。
![alt 文本](./../../图片/发送请求.png)

起使开头的GET表示请求访问服务器的类型，称为方法(method)。随后的字符串/index.htm指明了请求访问的资源对象，也叫做请求URI。最后的HTTP/1.1，即HTTP的版本号，用来提示客户端使用的HTTP协议功能。

综合来看，这段请求内容的意思是：请求访问某台HTTP服务器上的/index.htm页面资源。

**请求报文的构成**

请求报文是由请求方法、请求URI、协议版本、可选的请求首部字段和内容实体构成的。

![alt 文本](./../../图片/请求报文.png)



**响应报文的构成**

![alt 文本](./../../图片/响应报文.png)

在起始开头的HTTP/1.1表示服务器对应的HTTP版本。

紧挨着的200 OK表示请求处理结果的状态码和原因短语。
下一行显示了创建响应的日期时间，是首部字段内的一个属性。

接着以一空行分割，之后的内容称为资源实体的主体。

响应报文基本上由协议版本、状态码(表示请求成功或失败的数字代码)、用以解释状态码的原因短语、可选的响应首部字段以及实体主体构成。

![alt 文本](./../../图片/响应报文2.png)



----

### 2.3 HTTP是不保存状态的协议
HTTP是一种不保存状态，即无状态协议。HTTP协议自身不对请求和响应之间的通信状态进行保存。也就是说在HTTP这个级别，协议对于发送过的请求或响应都不做持久化处理。

使用HTTP协议，每当有新的请求发送时，就会有对应的新响应产生。协议本身并不保留之前一切的请求或响应报文的信息。这是为了更快地处理大量事务，确保协议的可伸缩性，而特意把HTTP协议设计成如此简单的。

可是，随着Web的不断发展，因无状态而导致业务处理变得棘手的情况增多了。

HTTP/1.1虽然是无状态协议，，但为了实现期望的保持状态功能，于是引入了Cookie技术。有了Cookie再用HTTP协议通信，就可以管理状态了。

----
### 2.4 请求URI定位资源
HTTP协议使用URI定位互联网上的资源。正是因为URI的特定功能，在互联网上任意位置的资源都能访问到。

![alt 文本](./../../图片/请求URI.png)

当客户端请求访问资源而发送请求时，URI需要将作为请求报文中的请求URI包含在内。指定请求URI的方式有很多。
![alt 文本](./../../图片/指定请求方式.png)

----


### 2.5 告知服务器意图的HTTP方法
下面介绍HTTP/1.1中可使用的方法。

1. **GET：获取资源**

    GET方法用来请求访问已被URI识别的资源。指定的资源经服务器端解析后返回响应内容。如果请求的资源是文本，那就保持原样返回；如果是像CGI(通过网关接口)那样的程序，则返回经过执行后的输出结果。

    ![alt 文本](./../../图片/get.png)

    ![alt 文本](./../../图片/get2.png)
2. **POST:传输实体主体**

    POST方法用来传输实体的主体。

    虽然用GET方法也可以传输实体的主体，但一般不用GET方法进行传输，而是用POST方法。虽说POST的功能与GET很相似，但POST的主要目的并不是获取响应的主体内容。

    ![alt 文本](./../../图片/put.png)


3. **PUT:传输文件**
    PUT方法用来传输文件。就像FTP协议的文件上传一样，要求在请求报文的主体中包含文件内容，然后保存到请求URI指定的位置。
    ![alt 文本](./../../图片/put1.png)


4. **HEAD:获得报文首部**
    HEAD方法和GET方法一样，只是不返回报文主体部分。用于确认URI的有效性及资源更新的日期时间等。

    ![alt 文本](./../../图片/head.png)

    ![alt 文本](./../../图片/head1.png)





5. **DELETE:删除文件**
DELETE方法用来删除文件，是与OUT相反的方法。DELETE方法按请求URI删除指定的资源。
![alt 文本](./../../图片/del.png)







6. **OPTIONS：询问支持的方法**
![alt 文本](./../../图片/opt.png)

![alt 文本](./../../图片/opt1.png)
7. **TRACE:追踪路径**
![alt 文本](./../../图片/trace.png)
![alt 文本](./../../图片/trace1.png)



8. **CONNECT:要求用隧道协议连接代理**
![alt 文本](./../../图片/connect.png)


----

### 2.6 使用方法下达命令

向请求URI指定的资源发送请求报文时，采用称为方法的命令。

方法的作用在于，可以指定请求的资源按期望产生某种行为。方法中有GET、POST和HEAD等。

![alt 文本](./../../图片/方法表.png)

----

### 2.7 持久连接节省通信量
HTTP协议的初始版本中，每进行一次HTTP通信就要断开一次TCP连接。
![alt 文本](./../../图片/持久.png)
![alt 文本](./../../图片/持久2.png)

#### 2.7.1 持久连接
![alt 文本](./../../图片/持久连接.png)
![alt 文本](./../../图片/持久连接2.png)
![alt 文本](./../../图片/持久连接3.png)

#### 2.7.2 管线化
![alt 文本](./../../图片/管线化.png)
![alt 文本](./../../图片/管线化2.png)




----

### 2.8 使用Cookie的状态管理
![alt 文本](./../../图片/使用cookie.png)
![alt 文本](./../../图片/使用cookie2.png)
![alt 文本](./../../图片/使用cookie3.png)



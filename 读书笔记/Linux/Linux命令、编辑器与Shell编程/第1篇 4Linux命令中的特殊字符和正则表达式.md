### 4 Linux命令中的特殊字符和正则表达式
许多时候需要筛选有用信息，这些信息可能包含在文件名称、命令输出、文本文件中。Linux系统引入一些特殊字符和正则表达式，来解决只记得筛选内容中的一部分或不连续的几部分。


#### 4.1 命令中的特殊字符
在Linux系统中有很多字符具有特殊意义，这些字符通常用来被引用、匹配(作用与通配符相同)、改变命令运行顺序等。
##### 4.1.1 字符串引用符双引号和单引号
在使用Linux的过程中，经常需要引用一些文本、变量、函数等，为了区分这些引用，需要使用引用符号。常见的引用符号有双引号、单引号、倒引号(有时也称反引号)和美元符号等，其中双引号和单引号的主要作用是引用字符串，避免引起误解。

1. 双引号
双引号""通常用来表示引用一个字符串，有时能屏蔽一些标点等特殊字符。在命令中使用双引号时，一般表示引用的部分是一个不可分割的整体。

    (1) 屏蔽特殊字符
    如果要在命令中使用一个比较长的字符串作为参数，通常应该将这些字符串放入双引号内，避免Shell对字符串中的某些字符产生误解。
    ```$ echo Jhon Alixx Jack;Mary Roman```
    上面这个示例中包含了特殊字符分号";"(分号表示一个命令的结束、另一个命令的开始)，因此引起了系统误解。像这种情况一般应该使用双引号表示字符串的引用：
    ```$ echo "Jhon Alixx Jack;Mary Roman" ```

    (2) 在双引号中使用其他引用符
    如果要在双引号引用的字符串中引用，应该使用其他引用符号。例如使用"$"引用变量：
    ```$ NAME="Mary"```
    ```$ echo "Jhon Alix Albert Jack;Mary Roman $NAME" ```
    除了变量引用符号，还可以使用命令输出引用符：
    ```$ echo "Now time: `date`" ```

    (3) 在命令中使用双引号
    在一些命令中还经常使用双引号避免Shell误解选项的含义等。例如：
    ```$ NAME="Jhon Alix Albert Jack; Mary Roman Mary" ```
    ```$ echo $NAME | grep Jhon Alix 由于没有使用双引号，grep将参数Alix当成文件处理，从而引起误解```
    ```$ echo $NAME | grep "Jhon Alix"```

2. 单引号
单引号和双引号都是将引号中的内容都当作字符串来处理，不同的是单引号通常在一些特殊命令中与双引号配合，表示引用中的引用(Shell中不允许一条命令中的两个引号都使用双引号或单引号)。
(1) 简单示例：
    ```$ echo $NAME | grep 'Jhon Alix' ```
(2) 使用单引号配合：
    ```$ awk 'BEGIN{system("date +'%Y%m%d%t%T' ")}' ```

##### 4.1.2 命令引用符反引号
反引号"``"有时也称为倒引号，这个键通常位于键盘的Tab键上方、数字键1的左边。反引号主要用来引用一些函数、命令输出等，执行时系统会尝试将反引号中的内容当作一个命令去执行。
>提示：如果在一条命令中出现了反引号，系统会首先执行反引号内的命令
1. 使用反引号：
    ```$ ls -l `cat /etc/shells` 将cat命令的执行结果作为ls命令的参数```
    将命令cat /etc/shells放入反引号中，表示这是一个命令而不是一个参数。
2. 在字符串中嵌套和使用一个命令的情况经常用到：
    ```$ echo "Now time:`date + '%T'`" ```
3. 可以在反引号中引用更长的命令：
    ```# 使用who和awk命令将联线用户输出给echo命令```
    ```# echo "Are using this system users: `who | awk '{ARR[FNR]=$1;}END{printf "%s %s\n",ARR[1],ARR[2]; }'` "```


##### 4.1.3 变量引用和命令转换符美元符号
美元符号"$"表示一个引用变量，引用一个变量时只需在变量名称前面加上"$"符号即可。
1. 下面是一个使用变量的例子：
   ```$ date=`date` 使用一个变量保存当前的日期并输出```
   ```$ echo "Host time is: $date" ```
2. 美元符号"$"还可以用来置换一个命令，使用美元符号置换命令时，Bash会将相应的命令放入子Shell中执行。
   ```$ ls -l $(cat /etc/shells) 使用命令转换符引用命令输出```

##### 4.1.4 反斜线屏蔽符
许多时候需要在输出中使用这些特殊字符本身，这时应该使用反斜线"\"(也称反斜杠)屏蔽其特殊的含义。
1. 使用美元符号表示货币：
    ```$ echo "Please pay \$15.50 . "```
2. 当输出内容中含义引号时，应该使用反斜线屏蔽引号的特殊含义：
    ```$ echo "Tom:\"What is your name?\" " ```



#### 4.2 文件名通配符
在使用Linux系统的过程中，许多时候都需要查找一个文件。如果只能记住文件名的一部分，查找时就显得非常困难。这时可以考虑使用文件名通配符。
##### 4.2.1 单字符匹配元字符"?"
元字符"?"表示匹配文件名任意一个字符，连续使用多个元字符"?"可以表示多个任意字符。

1. 例如要在当前目录下查找两个字符且第1个字母是a的文件：
   ```# ls -l a? 使用a?表示以a开头且有两个字符的文件名```
##### 4.2.2 多字符匹配元字符"*"
元字符"*"表示匹配文件名中的任意字符串/匹配的字符串长度可以是零到一个字符，也可以是长度很长的多个字符组成的字符串。

1. 例如要查看当前目录下以字母c结尾的所有文件：
   ```# ls -l *c```
2. 例如要查看当前目录下所有以字母ee开头并以字母c结尾的文件：
   ```# ls -l ee*c```

##### 4.2.3 字符范围匹配符"[]"

1. 如果范围匹配符中出现的是几个字符的组合，表示匹配其中的任意一个字符。
```# ls -l [klsyz]* 查看当前目录中以klsyz中任意字母开头的所有文件```

2. 使用多个通配符可以进行更加复杂的匹配查找。
    ```# ls -l a*[cde]?  查看以字母a开头且倒数第2个字符为cde中任意一个字母的所有文件```

3. 使用符号"-"可以匹配一个字母或数字范围。
   ```# ls -l *[0-9]* 查看当前目录中文件名中包含数字的所有文件```
4. 要查看当前目录下文件名由两个字符组成且第2个字符是字母的所有文件：
   ```# ls -l ?[a-Z]  [a-Z]表示所有小写字母、大写字母```
##### 4.2.4 排除范围匹配符"[!]"

1. 例如要查看当前目录下文件名只有两个字符并以数字开头且第2个字符不是数字所有文件：
    ```# ls -l [0-9][!0-9]```

2. 要查看当前目录下文件名只有两个字符且两个字符都不是字母的所有文件：
   ```# ls -l [!a-Z][!a-Z] ```
   


#### 4.3 多条命令中的逻辑运算符和括号
使用多条命令执行任务时，两条相邻的命令之间可能会存在某种依赖关系，例如后一条命令是否需要执行，依赖于前一条命令是否能够成功执行。
类似于C语言的if语句，不同的是if语句使用的是条件判断，而此处为前一个命令的执行情况。

Linux系统提供了两个逻辑运算符：逻辑或"||"和逻辑与"&&"，还提供了两个括号：小括号和大括号。


##### 4.3.1 逻辑或"||"
**运算符格式**
``` command1 || command2```
执行命令时，先执行命令command1，如果command1执行成功，则跳过命令command2执行后面的内容，执行失败就会执行命令command2。

1. 读取邮件的例子：
```# mail -f /root/mbox || echo "Permission denied" 如果执行mail命令失败，则使用echo命令输出错误信息```
 

2. 逻辑或在管理和维护系统的过程中有时很有用。例如测试两个主机间的连通性，如果失败则返回提示：
   ```# ping 125.1**.***.* -c3 &>/dev/null || echo "Host Web1 network connection is lost."```
   
##### 4.3.2 逻辑与"&&"
**运算符格式**
``` command1 && command2```
系统运行上面的命令时，会先执行命令command1，如果执行成功，则会进行执行命令command2；如果执行失败，就会通过command2。

1. 例如为移动文件添加提示信息：
   ```# mv ~/rm.txt ~/test/ && echo "Successfully moving files." 使用mv命令移动文件，如果成功，则输出提示信息```
2. 在管理和维护系统时，逻辑与可以用于当测试正常时向用户输出提示信息。例如检查主机Web1服务器是否能正常提供服务并输出提示信息：
```# wget http://125.1**.***.* &>/dev/null && echo "`date + '%Y%m%d %T%t'` Host Web1 service running."```
##### 4.3.3 括号
Linux系统提供了两个括号：圆括号"()"和花括号"{}"。


**括号的基本格式**
```(command1;command2;command3...)```
```{command1;command2;command3...}```
Linux系统遇到括号时，会按顺序先执行括号内的命令，直到括号内的所有命令执行结束，然后再返回执行其他命令。

```# ping 125.1**.***.* -c3 &>/dev/null || ( 有点复杂)```



#### 4.4 命令中的正则表达式
使用文件名通配符模糊查找文件非常高效，而如果要在命令输出或文本中筛选内容时使用模糊查找，就需要使用正则表达式。正则表达式是一套由多个元字符组成的模糊查找模式，使用正则表达式可以快速查找和定位文本中指定的内容。



##### 4.4.1 单字符匹配符"."
单字符匹配符"."可以匹配任意单个字符，这个字符的功能与文件名匹配符中的"?"功能相同。
要使用正则表达式查找文本，首先需要使用元字符组成一个查找模式。

1. 使用查找模式时，通常将其放入两个斜杠"//"中，然后再放入命令中。例如要在一个文本中查找匹配模式"/.i....../"，可能出现的匹配选项有：
```# 匹配模式可以匹配任意位置的文本```
```Jiangsu...```
```Sichuan...```
2. 例如对一个格式化字符串学号使用单字符匹配符"/27210103../"
    ```2721010301...```
    ```2721010305...```
    ```2721010307...```

##### 4.4.2 单字符或字符串重复匹配符"*"
单字符或字符串重复匹配符"*"用来匹配单个字符或一个字符串序列的一次或多次重复出现。

例如使用"/bo*/"
    ```boooooo...```
    ```bookokok...```
    ```bokkkkkkk...```

##### 4.4.3 行首匹配符"^"

1. 例如对命令ls -l 使用行首匹配"/^l/"，可以匹配的结果有：
    ```lrwxr ...```
    ```lrwxrwx--x ...```
    ```lrwx--x--x ...```

**提示**：由于正则表达式不具备匹配文件名的功能，因此不能对ls -l命令直接使用以上匹配模式。可以使用ls -l | grep /^l/

2. 例如对一个学生表使用行首匹配符"/^2721010325/":
```2721010325...```

##### 4.4.4 行尾匹配符"$"

1. 例如在文本中匹配所有行尾是love的行：
   ```/love$/```
2. 匹配所有只有5个字符的行：
   ```/^.....$/```
3. 要匹配所有以over结尾的行：
   ```/over$/```
##### 4.4.5 反斜杠屏蔽符"\"
反斜杠"\"用来屏蔽一些特殊字符的特殊含义。
**特殊符号**：
- 注释、分割符号：#、；等。
- 引用符号：$、``、""等。
- 元字符：.、*、$、?、[]、\等。
- 逻辑运算符和操作符：||、&&等。

1. 例如要使用符号"*"做乘法运算，就必须使用反斜杠将其特殊含义屏蔽后再使用：
    ```# expr 256\* 256```
2. 例如要使用注释符号"#"和反斜杠"\:"
    ```# echo \#notes\\```
    ```#notes\```
3. 要在正则表达式表示文件名为："^^.txt":
    ```/\^\^\.txt/```
##### 4.4.6 范围匹配符"[]"和排除范围匹配符"[^]"

1. 例如要匹配单词love和Love；
    ```/[Ll]ove/```
2. 要匹配所有的数字：
    ```[0123456789]```
3. 也可以使用符号"-"表示这个集合：
    ```[0-9]```
4. 而要匹配所有的字母可以使用以下两种方式：
    ```[a-Z] [a-z A-Z]```
5. 不匹配所有的字母：
    ```[^a-Z]```

##### 4.4.7 词首、词尾匹配符"\<"和"\>"
词首匹配符"\<"和词尾匹配符"\>"用于在单词开头和单词结尾匹配特定的字符和模式。
1. 例如要匹配所有以disc为词首的文本，可以使用：
    ```/\<disc//```
2. 要匹配所有以ment为词尾的文本，可以使用：
    ```/ment\>/```
3. 要匹配完整的单词the，可以使用：
    ```/\<the\>/```

##### 4.4.8 重复次数匹配符"x\{\}"
重复次数匹配符"x\{\}"可以匹配字符或字符串连续出现的次数或次数范围。

1. 要匹配字母m出现次数为5次的文本，可以使用
    ```/m\{5\}/```
2. 要匹配字母mc出现次数至少5次的文本，可以使用:
    ```/m\{5,\}/```
3. 匹配字母m出现次数5至10次的文本，可以使用:
    ```/m\{5,10\}/```



##### 4.4.9 组合并使用正则表达式

1. 在查找和筛选信息时，有时需要去除文本中的空行，由于空行没有任何字符，可以使用行首、行尾匹配符匹配空行。
    ```/^$/```
2. 有时一些文本为了看上去更加美观，会使用一种字符填充整行，可以使用以下模式匹配这些行：
    ```/^.*$/```
3. 匹配以the或The开头的所有行：
    ```/^[tT]he/```
4. 排除以the或The开头的所有行：
    ```/^[^Tt]he/```
5. 匹配一个IP地址：
    ```/[0-9]\{1,3\} \. [0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}/```
6. 匹配一个6个字符组成的字符串，前两个字符是字母，中间两个字符是22且最后两个字符是小写字母：
    ```/[a-Z]\{2\}/22[a-z]\{2\}```
7. 要精确匹配单词love:
    ```/\<love\>/```
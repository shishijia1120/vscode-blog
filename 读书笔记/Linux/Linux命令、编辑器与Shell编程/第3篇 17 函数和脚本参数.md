## 17 函数和脚本参数

### 17.1 Shell中的函数
#### 17.1.1 在脚本中定义函数
(1) 在脚本中可以使用以下方式定义函数：
```
function_name()
{
    语句1
    语句2
    ......
}
```
(2) 或者这样，建议使用这种方式：
```
function function_name()
{
    语句1
    语句2
    ......
}
```

**函数的命名规则**
- 为了区别变量，建议所有函数名都由小写字母和下划线组成，并以字母开头。
- 不要使用命令作为函数名称。
- 不要在函数名中使用特殊字符。
- 函数名应该尽量体现其功能。

#### 17.1.2 在脚本中使用函数
```
# cat example17.1.sh

...
# 定义一个名为hello的函数
hello()
{
    ...
}

调用函数hello
echo "Now call the fuction hello."
hello

```

#### 17.1.3 向函数传递参数和返回值

(1)使用位置变量传递参数
```
# cat example17.2.sh

...
# 定义一个名为A的函数
function A()
{
    echo `expr $1 + $2`
}

调用函数A
D='A 100 300'

echo "D="$D
```

(2) 使用echo命令返回函数结果的方法并不适用于所有的情况，当需要返回的值有许多时，echo命令处理起来就比较麻烦了。这时可以借助变量：
```
# cat example17.2.1.sh

...
# 定义一个名为A的函数
function A()
{
    D= `expr $1 + $2`
}

调用函数A
A 100 300
echo "D="$D
```
上例中，函数的返回值是通过变量来完成的，这种方法是借助变量的作用域在脚本中的全局性。

(3) 许多时候会出现另一种情况，即需要捕获函数是否成功执行。可以使用预定义变量$?，来返回前一个命令的执行状态。
```
# cat example17.2.2.sh

...
# 定义一个名为A的函数
function A()
{
    echo `expr $1 + $2`
}

调用函数A
D='A 100 300'

if [$? = 0 ]
    then
        echo "Function succeeds!"
        echo "D="$D
    else
        echo "Function fails."
fi
```

(4) 可简写if语句为：
```if D='A 100 300' ```

#### 17.1.4 返回函数执行状态

- return:将函数最后一条命令的执行状态作为其状态信息返回。
- return 0：返回函数成功执行的信息。
- return 1:返回函数错误的信息。

### 17.2 在Shell中使用函数文件
函数文件的格式和脚本文件一样。


#### 17.2.1 函数文件的编写
函数文件function.example:
。。。。。。

#### 17.2.2 函数文件的调用
(1)
```
# cat example17.3.sh
...

# 使用执行的方法调用函数文件 
. ./fuction.example

# 调用函数文件中的函数hello
echo "Now call the function hello."

# 调用时传递参数
hello Jhon

# 调用函数文件中的函数hi
echo "Now call the function hi."
hi Alix

```

从上面的示例文件中可以看出，调用函数文件的格式为：
```. ./function_file_name```

使用这种方式调用函数文件时，函数文件的路径应该与脚本文件的路径相同，否则在调用时应该使用函数文件的绝对路径或相对路径。

执行示例脚本example17.3.sh：
```# ./example17.3.sh```



(2) 或者在命令提示符中调用函数文件后，就可以直接调用函数。
```
# . ./function.example
# 调用函数hi
# hi Alix

```


用户也可以使用上面的方法，将函数文件写入用户的环境变量配置文件中，然后像使用命令一样调用自定义的函数，以实现较复杂的功能。

### 17.3 两个示例脚本


#### 17.3.1 示例1：检查包的依赖性
编写一个依赖性检查脚本，让脚本自动查找软件依赖的文件所在的软件包，并输出给用户。


```
# cat example15.4.sh

# 定义查询函数
function query()
{

 。。。。。。
}



```

#### 17.3.2 示例2：监控文件系统
。。。。。。


### 17.4 向脚本传递参数
在15章中，介绍了使用位置变量获取传递给脚本的参数的方法，但使用位置变量最多只能获取9个参数，当要使用的选项，参数大于9时，位置变量就无能为力了。
#### 17.4.1 使用shift命令处理参数
运行shift命令时，位置变量就像一个可以移动的"指针"，每执行一次，位置变量指向的参数将向后移动一位。即使用shift命令后，位置变量$1的值等于使用命令前的$2的值，$2的值等于使用命令前的$3，依此类推。随着shift命令的使用，位置变量$1的值会不断变化，直到移动到最后一个参数之后。使用shift处理参数常见于与用户交互的命令式脚本中。

(1) 示例脚本：

```
# cat example17.5.sh

fuction usage()
{
    ...
    return 1
}
# 判断是否有传递有参数，如果没有，则调用函数usage
if [$# = 0]
    then
        usage
        exit 1
fi
# 定义变量I，用于计算变量的个数
I=1

while [$# != 0]
    do
        echo "\$"$I"="$1
        shift
        I='expr $I +1'
done
exit 0
```

```
# ./example17.5.sh 1 2 3 4 5 6 7 8 9 10
$1=1
$2=2
...
$10=10

```
(2) 示例脚本：
```
# cat example17.5.1.sh

fuction usage()
{
    ...
    return 1
}
# 判断是否有传递有参数，如果没有，则调用函数usage
if [$# = 0]
    then
        usage
        exit 1
fi


while [$# != 0]
    do
        echo "\$"1"="$1" \$"2"="$2" \$"3"="$3"
        shift
done
exit 0
```

```
# ./example17.5.1.sh a b c d e f g h i j  
$1=a $2=b $3=c
$1=b $2=c $3=d
$1=c $2=d $3=e
...
$1=i $2=j $3=
$1=j $2= $3=
```

#### 17.4.2 使用shift命令处理选项参数
```
while [ $# -gt 0]
    do
        case $1 in
            -a) #功能语句块
                # 出现选项a时应该执行的语句
                shift
                ;;
            -b) #功能语句块
                # 出现选项b时应该执行的语句
                shift
                ;;
            -c) #功能语句块
                # 出现选项c时应该执行的语句
                shift
                ;;
            esac
done

```

